version: '3.4'
services:
  flowcentral:
    image: axway/flowcentral:1.0.20190425
    hostname: "flowcentral"
    stdin_open: true
    tty: true
    environment:
        ### EULA ###
        ACCEPT_EULA: "no"

        #General
        FC_GENERAL_FQDN                              : "flowcentral"
        FC_GENERAL_HOSTNAME                          : "flowcentral"
        FC_GENERAL_UI_PORT                           : "8081"
        FC_GENERAL_ENCRYPTION_KEY                    : "Secret01"
        FC_GENERAL_LOGGING_LEVEL                     : "INFO"
        FC_GENERAL_LICENSE                           : "license.xml"

        #HTTPS
        FC_HTTPS_USE_CUSTOM_CERT                     : "true"
        FC_HTTPS_KEYSTORE                            : "/opt/axway/configs/uicert.p12"
        FC_HTTPS_CERT_ALIAS                          : "ui"
        FC_HTTPS_KEYSTORE_PASSWORD                   : "Secret01"


        #CFT
        FC_CFT_SHARED_SECRET                         : "Secret01"

        #APIC
        FC_APIC_USE_CATALOG                          : "true"
        FC_APIC_HOST                                 : "https://apicentral.axway.com"
        FC_APIC_CLIENTID                             : "DOSA_XXXXXXXXXXXXXXXXXXXXXXXXXXX"
        FC_APIC_PUBLICKEY                            : "/opt/axway/configs/catalog-public-key.pem"
        FC_APIC_PRIVATEKEY                           : "/opt/axway/configs/catalog-private-key.pem"
        FC_APIC_TOKENURL                             : "https://login.axway.com/auth/realms/Broker/protocol/openid-connect/token"

        #Mongo
        FC_MONGODB_HOST                              : "fcmongo"
        FC_MONGODB_PORT                              : "27018"
        FC_MONGODB_USER_NAME                         : "storage"
        FC_MONGODB_USER_PASSWORD                     : "storage"

        #Business
        FC_BUSINESS_CA_CERTIF_ALIAS                  : "business"
        FC_BUSINESS_CA_FILE                          : "/opt/axway/configs/businessca.p12"
        FC_BUSINESS_CA_PASSWORD                      : "Secret01"

        #GOVERNANCE
        FC_GOVERNANCE_CA_CERTIF_ALIAS                : "governance"
        FC_GOVERNANCE_CA_FILE                        : "/opt/axway/configs/governanceca.p12"
        FC_GOVERNANCE_CA_PASSWORD                    : "Secret01"
    ports:
      - 8081:8081
    depends_on:
      - fcmongo
    volumes:
     - "./mounts/fc_logs:/opt/axway/fc_logs"
     - "./mounts/fc_keys:/opt/axway/FlowCentral/data/keys/com.axway.nodes.ume"
     - "./mounts/configs:/opt/axway/configs"
     - "./mounts/configs:/opt/axway/FlowCentral/conf/license"

  fcmongo:
    build: ./mongo-3.4/
    volumes:
      - "./mounts/mongo_data:/data/db/"
    ports:
      - 27018:27018
    environment:
      MONGODB_ADMIN_USER              : root
      MONGODB_ADMIN_PASS              : storage
      MONGODB_APPLICATION_DATABASE    : umcft
      MONGODB_APPLICATION_USER        : storage
      MONGODB_APPLICATION_PASS        : storage
